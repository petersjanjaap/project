# Description
This visualization describes global trade flows of the U.K. with the rest of the world based on the aim of the British government to become a 'Global Britain' after leaving E.U. trade agreements with Brexit. This visualization offers users a view of U.K. trade relations over the years 2000-2017 and potentially interesting partner markets measured by GDP.
![alt text](https://github.com/petersjanjaap/project/blob/master/Images/Index_p1.png)

# Design
**Technical design**\
All scripts can be found in the SCRIPTS map.

_API.py_\
The API.py file was used to obtain the data from the World Bank development indicators page and the data on world trade. The data was downloaded and entered into dictionaries, which was then converted to JSON files and saved. Because the data format from the World Bank was sometimes inconsistent in labelling I adjusted some of the titles of given variables. The country codes and country names were saved as a separate JSON to use as dictionary later to display countries names instead of country codes in the tooltip and titles. The trade data file was formatted into years -> countries -> percentages in export and import or total values of trade sectors. The GDP datafile was formatted as countries -> years -> data. 

_project.js_\
The main file used is project.js. In this file width, height and padding for the svgs are initialised as well as all the globals used in the programme. The globals include all four datasets, namely GDP, TRADE, COUNTRIES (names and country codes) and the geoJson map, as well as the selected COUNTRY, YEAR and TRADEFLOW and MAPCOLOR. Width and height are based on the screen of the user. General components such as the tooltip, slider and the drop down are initialised here, although they are added to the map, because they serve a more general purpose than the compiling of the map. The functionalities to update the visualizations using the slider or drop down menu are used here as well. The slider selects the global YEAR, which updates all visualizations except the line grap. If the user has selected a COUNTRY for which no info in the given year is available, than the COUNTRY is defaulted to Germany ("DEU"). The drop down menu updates only the TRADEFLOW which affects the map. After initialising these components, the data on trade, countrie names, GDP and the geojson map are obtained, and then the map, line graph, bar chart and sun burst functions are called and the full page is built. 

_map.js_\
This file initializes and updates the map, based on colors and legends. The map has a larger size, because it is the central component of the page. First the title, legend and SVG are modified. Then the map is created using mapGenerator on the SVG and set at natural projection. After the map is created it is updated using the update function to the current selected global YEAR, global TRADEFLOW (either export or import) and the selected global COUNTRY, the latter has lower opacity and thicker borders. If the user has selected export the color range is set at green and with export it is set at red. Titles are adjusted to trade flow and selected year Mapcolors are set at 9 threshold scales. Next all countries, paths, are colored based on their share in the total UK trade flow and mouse functionalities are added, a tooltip and colorred to blue when the user hoovers over, and everything reset to normal on mouseout. The legends and colorfillings have separate functions at the bottom of the page. The function toolInfo is used to display information, depending on whether the country has information, or whether the user scrolls over the home country U.K. If the user clicks on the countries, than first it is checked whether it is not the UK, than whether trade information is present. In the first two cases the user is informed to select another country.If everything is valid the click function updates the bars, graph line and sun burst and scrolls down. The security checks also prevents errors. The countries dictionary is used to show country names in the tooltips and titles.
![alt text](https://github.com/petersjanjaap/project/blob/master/Images/map.png)

_linechart.js_\
First the SVG, titles, info button, axes and legend are initialised. The graph function clears the svg from all titles, paths and circles and replace these based on the selected input. The data is obtained using the getData funtion on the bottom of the page, where the data is copied from the original JSON file to edit it for usage, where year, export and import info are kept. The scales are created using total range for export and import, then the lines ('paths') are added interactivally using the transition function at the bottom at the page using a delay, so the user can see the transition while scrolling down, and the circles are added to the graph including a mouseover and mouseout function to display a tooltip containing information on trade flow value in the given year. Numbers are formatted in thousands, because million format sets every value below 1 million to zero and for many countries this is often the case. Axis are updated separately using transitions function. The line chart then displays total dollar values of export in the red line and import in the orange line over the years 2000-2017. The line chart is independent of the selected year or trade flow and only updates when a new valid country on the map is selected. Sectors included are Agriculture, Chemicals, Food, Fuels, Industry (manufacturing), Metals, Textiles and Transport.
![alt text](https://github.com/petersjanjaap/project/blob/master/Images/line.png)

_sunburst.js_\
First general variables suchh as radius of the sun burst, the partition function the color variable and the info button are initialised. A dictionary is used to transform sector names to better readable labels, because these are abbreviated in the original data. The sunburstgenerator function creates the sun burst. First the title is updated to display the selected country. The relevant data based on the selected COUNTRY and YEAR are obtained based on the function childrenObject, which transform it readable to the root function. The data is then partitioned on which the arc angles and slice sizes are built. The old sunburst is removed and replaced by new slices, which first turn white and transform to the new color while the text pops in from the center using a transformation to create a real sunburst effect. Texts are only shown if the size of the slice is large enough to contain the text, however tooltips are added to all slices. Further on, the text is rotated using the functions below and the user can also highlight a selected slice by clicking on it and thereby activating highlightSelectedSlice. This chart updates when a new partner country is selected on the map or if a new year is selected from the slider. The user has a good overview of export and import components to total trade and the sectors comprising export and import. The tooltip allows the user to see full dollar values.
![alt text](https://github.com/petersjanjaap/project/blob/master/Images/sun.png)


_barchart.js_\
First the svg, bars (including tooltips), axes titles and info buttons are created. The barchart generator then updates and transitions the actual bars. The relevant data on GDP is copied from the GDP JSON to be further edited. The data is ordinary and linearly scaled for the x and y axes. The bars are transformed based on this data. The sectors are inserted slightly rotated to the x axis. The bar chart then finally shows the sectors comprising GDP in the given COUNTRY for the selected YEAR. It updates when the user selects either a new country on the map or a new year from the slider. This chart offers the user an indication whether the market is potentially attractive to the U.K. based on the goods that are produced in the partner country. Unfortunately, sectors included in trade data were not the exact same as sectors included in GDP data provided by the World Bank but still similar. These included are Manufacturing, Agriculture, Oil, Coal, Mining, Services and Trade. 
![alt text](https://github.com/petersjanjaap/project/blob/master/Images/bar.png)


_HTML files_\
All HTML files use bootstrap to divide the SVG in a well-looking pattern. In the top the navigation bars are entered with the links to the relevant pages. Styles for all elements are included in the css file in the MAP styles. The SVG's for the visualizations are already included in the grids and classified with the name relevant to the visualations, for example svg class="map". The SVG's are selected in all scripts to adjust height and width etc. In this way the SVG's are placed in the right part of the grid. Index.html contains all visualizations and is used as home page, brexit.html contains a video on the effect of Brexit on trade and has a newsfeed linking to the Brexit sections of six news sources. The user can remain up to date about Brexit and know more on the complexity of trade and Brexit. In the about.html all visualizations are described and the links are provided to the add-ins and libraries, data and this Github repository. 


# Challenges
**Changes**\
The project had some significant alterations since the original proposal. The original idea was to visualize global trade flows between all countries worldwide. The total dataset had in excess of 9 million observations excluding on GDP. Without adjusting the datapackage it would make the website slow. Limiting the story to 'Global Britain' solved this problem. Also I ended up working with D3 instead of Python data visualization tools and did not have to use SQL, but could simply host the datafiles in JSON format on the Github page.

Several visualizations and their purpose were altered over the course of the project. The idea was to visualize trade components of export and import in a bar chart, but with 14 variables for export and import to visualize this was prone to look messy. Therefore I used a sun burst to visualize export and import components, because you can directly relate a specific sector to either export or import. In between I had the idea to use [an alternative visualization](http://www.brightpointinc.com/united-states-trade-deficit/), but because it is originally written in d3 v3, and because the sun burst excellently visualizes the data, I decided not to use it. 
This also led to the following alteration in the original idea of the project, namely to use the bar chart to visualize GDP components instead of the pie chart. Pie charts should display the total of something and the data the World Bank had did not divide the sectors in total GDP and there is overlap between the value of trade as % of GDP and sectors such as industry, because when you export an industry product it accounts for both industry and trade. The bar chart was therefore considered more appropriate. In the original proposal I had no feature to describe trade relations over time, so I also decided to add a line chart to the page to display the development of total export and import over time. Lastly, I also added separate HTML pages to provide background on the Brexit story and to display the sources used for the project. The original idea was to use one page, but this would prove messy.

**Final Argument**\
I am happy with all visualizations, because they appropriately visualize the information captured in the data and show the relationship of different countries over time and decomposed into export and import. Given more time I would have liked to give more background on trade of the UK with the EU and display mutual trade relationships to see how Global Britain would be different from pre-Brexit Britain. The most important feature I would change though was to soft code the size of all elements, because I found out that resizing the screen or viewing it on a mobile phone significantly reduced the layout design. Now I based height and width on screen size, but font size etc. should be based on screen type as well. There are further adjustments I would make to tooltip format, remove the tooltip on the slider button on the map (unfortunately the button is a 'rect' and is automatically selected by the tooltip, I found this out Wednesday). All in all, I am happy with the result and was challenged to critically evualute the designs chosen for the visualization.

